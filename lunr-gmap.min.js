/*! uglified 2014-09-17 16:16:46 */!function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0](function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b){(function(){var c,d,e,f,g,h,i,j,k=function(a,b){return function(){return a.apply(b,arguments)}};d=a("./Gmap.coffee"),j=a("./Search.coffee"),c=a("./Filters.coffee"),i=a("./Popin.coffee"),e=a("./List.coffee"),h=void 0,b.exports=g=function(){function b(a){var b=this;if(this.selector=a,this.loader=new f,this.loader.set("feed",!1),this.loader.set("map",!1),this.loader.set("list",!1),this.loader.emmitter.on("load.update",function(){return b.loader.isLoaded()?b.addMarkers(b.feed):void 0}),this.templates={single:"",list:""},this.checkDependencies(),this.$el=$(this.selector),this.$el.length>1)throw new Error("selector argument must refer to an unique node");return this.$el.empty(),this.templates.single=this.$el.attr("data-templateSingle"),this.templates.list=this.$el.attr("data-templateList"),this.fields=this.parseFields(this.$el.attr("data-lunr")),this.filter=this.$el.attr("data-filter"),this.initGmap(),this.popin=new i(this.selector),this.list=new e(this.selector,this.templates.list),this.list.$el.on("load",function(){return b.loader.set("list",!0)}),$.get(this.$el.attr("data-feed")).done(function(a){return b.feed=a,b.initFeed(),b.initFilters()}),$.get(this.templates.single).done(function(a){return b.templates.single=_.template(a)}),this}return b.prototype.initGmap=function(){var b=this;return this.map=new d(this.selector,this.$el.attr("data-latitude"),this.$el.attr("data-longitude"),parseInt(this.$el.attr("data-zoom"))),this.map.$el.on("load",function(){return h=a("./Marker.coffee"),b.loader.set("map",!0)}),this},b.prototype.initFeed=function(){var a=this;return this.search=new j(this.selector,this.feed,this.fields),this.search.$el.on("search.change",function(b,c){return google.maps.event.trigger(a.map.gmap,"search.change",[c.refs,"index","lunr"])}),this.loader.set("feed",!0),this},b.prototype.initFilters=function(){var a=this;return this.filters=new c(this.selector,this.feed,this.filter,this.$el.attr("data-templateFilters")),this.filters.$el.on("search.change",function(b,c){return google.maps.event.trigger(a.map.gmap,"search.change",[c.filter,a.filter,"filters"])}),this},b.prototype.addMarkers=function(a){var b,c,d;for(this.markers=new Array,c=0,d=a.length;d>c;c++)b=a[c],this.addMarker(b);return this},b.prototype.addMarker=function(a){var b,c=this;return a.position=new google.maps.LatLng(a.latitude,a.longitude),a.map=this.map.gmap,b=new h(a),this.markers.push(b),this.list.addMarker(b),google.maps.event.addListener(b,"click",function(){return c.displaySingle(b)}),this},b.prototype.displaySingle=function(a){return this.popin.setContent(this.templates.single(a)),this.popin.open(),this},b.prototype.parseFields=function(a){var b,c,d,e,f;for(c=new Array,f=a.split(","),d=0,e=f.length;e>d;d++)b=f[d],b=b.split("|"),c.push([b[0],parseInt(b[1])]);return c},b.prototype.checkDependencies=function(){if("undefined"==typeof $||null===$)throw new Error("jQuery not found");if("undefined"==typeof _||null===_)throw new Error("underscore not found");return this},b}(),window.LunrGmap=g,f=function(){function a(){return this.set=k(this.set,this),this.isLoaded=k(this.isLoaded,this),this.emmitter=$({}),this.modules=new Object,this}return a.prototype.isLoaded=function(){var a;for(a in this.modules)if(!this.modules[a])return!1;return!0},a.prototype.set=function(a,b){return this.modules[a]=b,this.emmitter.trigger("load.update"),this},a}()}).call(this)},{"./Gmap.coffee":2,"./Search.coffee":3,"./Filters.coffee":4,"./Popin.coffee":5,"./List.coffee":6,"./Marker.coffee":7}],2:[function(a,b){(function(){var a,c=function(a,b){return function(){return a.apply(b,arguments)}};b.exports=a=function(){function a(a,b,d,e){return this.latitude=b,this.longitude=d,this.zoom=e,this.create=c(this.create,this),this.id="map-canvas-"+(new Date).getTime(),$(a).append('<div id="'+this.id+'" class="map-canvas" />'),this.$el=$("#"+this.id),this.zoom||(this.zoom=4),this.loadGoogleMaps(),this}return a.prototype.loadGoogleMaps=function(){var a=this;return $.getScript("https://www.google.com/jsapi",function(){return google.load("maps","3",{other_params:"sensor=false",callback:a.create})}),this},a.prototype.create=function(){var a;return a=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],this.gmap=new google.maps.Map(document.getElementById(this.id),{zoom:this.zoom,center:new google.maps.LatLng(this.latitude,this.longitude),visualRefresh:!0,disableDefaultUI:!0,styles:a}),this.$el.trigger("load"),this},a}()}).call(this)},{}],3:[function(a,b){(function(){var a,c=function(a,b){return function(){return a.apply(b,arguments)}};b.exports=a=function(){function a(a,b,d,e,f){this.initSearch=c(this.initSearch,this);var g,h,i;if(this.$el=$('<div class="map-search" />'),$(a).append(this.$el),this.$input=$('<input type="text" />'),this.$el.append(this.$input),this.refs=this.results=new Array,f||(this.score=0),e||(e="keyup"),this.index=lunr(function(){var a,b,c,e;for(e=[],b=0,c=d.length;c>b;b++)a=d[b],this.field(a[0],a[1]),e.push(this.ref("index"));return e}),this.$input.on(e,this.initSearch),null!=b)for(h=0,i=b.length;i>h;h++)g=b[h],this.index.add(g);return this.$el.trigger("ready"),this}return a.prototype.initSearch=function(){return this.filter(),this.$el.trigger("search.change",{refs:this.refs}),this},a.prototype.getResults=function(){return this.results},a.prototype.getRefs=function(){return this.refs},a.prototype.filter=function(){var a,b,c,d;for(this.results=this.index.search(this.getFilter()),this.refs=new Array,d=this.results,b=0,c=d.length;c>b;b++)a=d[b],a.score>=this.score&&this.refs.push(a.ref);return this},a.prototype.clear=function(){return this.$input.val(""),this.filter(),this},a.prototype.getFilter=function(){return this.$input.val()},a}()}).call(this)},{}],4:[function(a,b){(function(){var a,c=function(a,b){return function(){return a.apply(b,arguments)}},d=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};b.exports=a=function(){function a(a,b,d,e){var f=this;return this.template=e,this.setFilter=c(this.setFilter,this),this.id="map-filters-"+(new Date).getTime(),$(a).append('<div id="'+this.id+'" class="map-filters" />'),this.$el=$("#"+this.id),this.parseData(b,d),this.filter=new Array,$.get(this.template).done(function(a){return f.template=_.template(a),f.render(),f.$filterBtns=f.$el.find(".map-filter"),f.$filterBtns.on("click",f.setFilter)}),this}return a.prototype.parseData=function(a,b){var c,e,f,g;for(this.filters=new Array,e=0,f=a.length;f>e;e++)c=a[e],g=c[b],d.call(this.filters,g)<0&&this.filters.push(c[b]);return this},a.prototype.render=function(){return this.$el.html(this.template({filters:this.filters}))},a.prototype.setFilter=function(a){var b;return a instanceof jQuery.Event&&(a.preventDefault(),b=$(a.target).closest(".map-filter"),a=b.attr("data-filter")),"all"===a||d.call(this.filter,a)>=0?(b.removeClass("active"),this.filter.splice(this.filter.indexOf(a),1)):(b.addClass("active"),this.filter.push(a)),this.$el.trigger("search.change",{filter:this.filter}),this},a}()}).call(this)},{}],5:[function(a,b){(function(){var a,c=function(a,b){return function(){return a.apply(b,arguments)}};b.exports=a=function(){function a(a){return this.close=c(this.close,this),this.open=c(this.open,this),this.id="popin-"+(new Date).getTime(),this.$wrapper=$('<div id="'+this.id+'" class="popin-wrap close" />'),this.$closeBtn=$('<button class="popin-close">close</button>'),this.$el=$('<div class="popin-content" />'),this.$wrapper.append(this.$closeBtn),this.$wrapper.append(this.$el),this.$parent=$(a).append(this.$wrapper),this.$closeBtn.on("click",this.close),this.$parent.on("list.open",this.close),this.$parent.on("list.close",this.open),this}return a.prototype.setContent=function(a){return this.$el.html(a),this},a.prototype.open=function(){return this.$wrapper.addClass("open"),this.$wrapper.removeClass("close"),this.$wrapper.trigger("popin.open"),this},a.prototype.close=function(){return this.$wrapper.addClass("close"),this.$wrapper.removeClass("open"),this.$wrapper.trigger("popin.close"),this},a}()}).call(this)},{}],7:[function(a,b){(function(){var a,c=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};b.exports=a=function(a){function b(a){this.filter=c(this.filter,this),b.__super__.constructor.call(this,a),this.engines=new Object,google.maps.event.addListener(this.getMap(),"search.change",this.filter)}return e(b,a),b.prototype.getField=function(a){return this[a].toString()},b.prototype.filter=function(a){var b,c,d;if(!a[2])throw new Error("The `search.change` pust pass an string identifier as thrid argument");c=a[2],this.engines[c]||(this.engines[c]=new Object),this.engines[c].field=a[1],this.engines[c].results=a[0];for(c in this.engines){if(b=this.engines[c],b.results.length&&(d=this.getField(b.field),!(f.call(b.results,d)>=0)))return this.setVisible(!1),this;this.setVisible(!0)}return this},b}(google.maps.Marker)}).call(this)},{}],6:[function(a,b){(function(){var c,d,e=function(a,b){return function(){return a.apply(b,arguments)}},f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=a("./Popin.coffee"),b.exports=c=function(a){function b(a,b){this.close=e(this.close,this),this.open=e(this.open,this);var c=this;return this.id="list-content-"+(new Date).getTime(),this.$parent=$(a).append('<div id="'+this.id+'" class="list-content close" />'),this.$el=this.$parent.find(".list-content"),this.markers=new Array,$.get(b).done(function(a){return c.template=_.template(a),c.$el.trigger("load")}),this.$parent.on("search.change",function(a){return"map-search"===a.target.className?c.open():void 0}),this.$parent.on("popin.open",this.close),this.$parent.on("popin.close",this.open),this}return g(b,a),b.prototype.addMarker=function(a){var b=this;return this.markers.push(a),this.render(this.markers),google.maps.event.addListener(a,"visible_changed",function(){return a.visible?b.showMarker(a):b.hideMarker(a)})},b.prototype.showMarker=function(a){return this.$el.find('[data-index="'+a.getField("index")+'"]').show(),this},b.prototype.hideMarker=function(a){return this.$el.find('[data-index="'+a.getField("index")+'"]').hide(),this},b.prototype.open=function(){return this.$el.hasClass("open")||(this.$el.addClass("open"),this.$el.removeClass("close"),this.$el.trigger("list.open")),this},b.prototype.close=function(){return this.$el.hasClass("close")?void 0:(this.$el.addClass("close"),this.$el.removeClass("open"),this.$el.trigger("list.close"))},b.prototype.render=function(a){var b=this;if(this.setContent(this.template({markers:a})),this.$closeBtn=this.$parent.find(".list-close"),this.$closeBtn.on("click",this.close),!this.$el.find("[data-index]").length)throw new Error('The attribute `data-index="<%=marker.index%>` is required in template file" ');return this.$el.find("[data-index]").on("click",function(c){var d;return b.close(),d=$(c.target).closest("[data-index]").attr("data-index"),google.maps.event.trigger(a[d],"click")}),this},b}(d)}).call(this)},{"./Popin.coffee":5}]},{},[1]);